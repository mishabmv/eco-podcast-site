<script>
  const rssUrl = 'https://cloud.mave.digital/feed/40395';
  const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(rssUrl);

  fetch(proxyUrl)
    .then(res => res.json())
    .then(data => {
      const str = data.contents;
      const xml = new window.DOMParser().parseFromString(str, "text/xml");
      const items = Array.from(xml.querySelectorAll("item"));
      const seasons = {};

      items.forEach(item => {
        const title = item.querySelector("title")?.textContent || "";
        const description = item.querySelector("description")?.textContent || "";
        const pubDate = new Date(item.querySelector("pubDate")?.textContent || "");
        const duration = item.querySelector("itunes\\:duration")?.textContent || "";
        const season = item.querySelector("itunes\\:season")?.textContent || "1";

        if (!seasons[season]) seasons[season] = [];

        seasons[season].push({ title, description, pubDate, duration });
      });

      const container = document.getElementById("episodes");

      Object.keys(seasons).sort((a, b) => b - a).forEach(season => {
        const details = document.createElement("details");
        const summary = document.createElement("summary");
        summary.textContent = `Сезон ${season}`;
        details.appendChild(summary);

        seasons[season].forEach(ep => {
          const div = document.createElement("div");
          div.className = "episode";
          div.innerHTML = `
            <div class="episode-title">${ep.title}</div>
            <div class="episode-meta">Дата: ${ep.pubDate.toLocaleDateString()} | Длительность: ${ep.duration}</div>
          `;
          details.appendChild(div);
        });

        container.appendChild(details);
      });
    })
    .catch(err => {
      document.getElementById("episodes").innerText = 'Не удалось загрузить список эпизодов.\n\n' + err.message;
      console.error('Ошибка:', err);
    });
</script>
