<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Подкаст</title>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 800px; margin: auto; }
    .episode { border-top: 1px solid #ccc; padding-top: 1em; margin-top: 1em; }
    audio { width: 100%; margin-top: 0.5em; }
  </style>
</head>
<body>

  <h1 id="podcast-title"></h1>
  <p id="podcast-description"></p>

  <div id="episodes"></div>

  <script>
    const metaCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRS9tUcKNqA8bLHqKF89gR6YwKyDwOoq4ldzdMN6jTbDIFLtGvYfyqyF7ENtXd3t4EZvcoKMlYqe5M0/pub?gid=742193249&single=true&output=csv';
    const episodesCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRS9tUcKNqA8bLHqKF89gR6YwKyDwOoq4ldzdMN6jTbDIFLtGvYfyqyF7ENtXd3t4EZvcoKMlYqe5M0/pub?gid=0&single=true&output=csv';

    function parseCSV(text) {
      return text.trim().split('\n').map(row =>
        row.split(',').map(cell => cell.replace(/^"|"$/g, '').replace(/""/g, '"'))
      );
    }

    // Загрузить и отобразить метаданные
    fetch(metaCsvUrl)
      .then(res => res.text())
      .then(text => {
        const rows = parseCSV(text);
        const headers = rows[0];
        const values = rows[1];
        const meta = Object.fromEntries(headers.map((h, i) => [h.trim(), values[i]]));

        document.getElementById('podcast-title').textContent = meta.title || 'Подкаст';
        document.getElementById('podcast-description').textContent = meta.description || '';
        if (meta["itunes:image"]) {
          const img = document.createElement('img');
          img.src = meta["itunes:image"];
          img.style.maxWidth = "100%";
          img.style.margin = "1em 0";
          document.body.insertBefore(img, document.getElementById("episodes"));
        }
      });

    // Загрузить и отобразить эпизоды
    fetch(episodesCsvUrl)
      .then(res => res.text())
      .then(text => {
        const rows = parseCSV(text);
        const headers = rows[0];
        const episodes = rows.slice(1).map(row =>
          Object.fromEntries(headers.map((h, i) => [h.trim(), row[i]]))
        );

        const container = document.getElementById("episodes");
        episodes.forEach(ep => {
          const div = document.createElement("div");
          div.className = "episode";
          div.innerHTML = `
            <h3>${ep.title}</h3>
            <p><strong>Дата:</strong> ${ep.pubDate || "—"} | <strong>Длительность:</strong> ${ep["itunes:duration"] || "—"}</p>
            <p>${ep.description || ep["content:encoded"] || ""}</p>
            <audio controls src="${ep.enclosure || ""}"></audio>
          `;
          container.appendChild(div);
        });
      });
  </script>
</body>
</html>
